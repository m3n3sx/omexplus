import{f as A}from"./chunk-IR5DHEKS-aVJcUHa1.js";import{a as B,T as H}from"./chunk-OI7BBNYW-DJOf1CE_.js";import{R as N,aW as O,j as t,b,aa as I,r as m,ey as Q,eC as V,t as S,B as j,ad as $,k as G,a4 as U,af as W,a6 as Z}from"./index-DX2a82HP.js";import{u as J}from"./chunk-W7625H47-Dim5Y5EB.js";import{u as K,D as X}from"./chunk-XVFA73MY-AMj50WTj.js";import"./lodash-CVxbbwuF.js";import{u as Y}from"./chunk-C76H5USB-jBtboAOl.js";import"./chunk-5AU4DI7M-HrTrxcOJ.js";import"./chunk-E3YGDIJC-JnAcRQyg.js";import{R as d,u as ee}from"./chunk-MDIOSTKB-DN-HuFMP.js";import{c as k}from"./index-BUcLkKzP.js";import{C as y}from"./checkbox-BO157Suw.js";import"./chunk-P3UUX2T6-DeTt74xj.js";import"./chunk-YEDAFXMB-pzp1i2bd.js";import"./chunk-AOFGTNG6-CQXl4ceK.js";import"./chunk-WX2SMNCD-C6PHMHma.js";import"./plus-mini-Dl4b05ye.js";import"./command-bar-DI3uUyU0.js";import"./index-CzIYclp8.js";import"./chunk-QAF7PVQE-q7JGHsta.js";import"./format-CG1SSrem.js";import"./date-picker--Tjqtae5.js";import"./popover-BPEhH8ld.js";import"./x-mark-mini-p1eXR82b.js";import"./triangle-left-mini-LkqMp4G9.js";import"./prompt-BcBTqHKt.js";var te=k(),se=()=>{const{t:s}=b();return m.useMemo(()=>[te.accessor("id",{header:()=>t.jsx(H,{text:"Provider"}),cell:({getValue:e})=>t.jsx(B,{text:A(e())})})],[s])},re=({prefix:s,pageSize:e=20})=>{const r=Y(["offset","q","stock_location_id"],s),{offset:a,q:n,stock_location_id:u}=r;return{searchParams:{limit:e,offset:a?Number(a):0,stock_location_id:u,q:n},raw:r}},oe=U({fulfillment_providers:W(Z()).optional()}),f=50,ae=({location:s})=>{var v,x;const{t:e}=b(),{handleSuccess:r}=ee(),a=I({defaultValues:{fulfillment_providers:((v=s.fulfillment_providers)==null?void 0:v.map(o=>o.id))??[]},resolver:$(oe)}),{setValue:n}=a,u=((x=s.fulfillment_providers)==null?void 0:x.reduce((o,i)=>(o[i.id]=!0,o),{}))??{},[c,_]=m.useState(u);m.useEffect(()=>{const o=Object.keys(c);n("fulfillment_providers",o,{shouldDirty:!0,shouldTouch:!0})},[c,n]);const{searchParams:C,raw:F}=re({pageSize:f}),{fulfillment_providers:T,count:p,isLoading:w,isError:R,error:E}=Q({...C,is_enabled:!0},{placeholderData:G}),D=J(),h=le(),{table:L}=K({data:T??[],columns:h,count:p,enablePagination:!0,enableRowSelection:!0,rowSelection:{state:c,updater:_},getRowId:o=>o.id,pageSize:f}),{mutateAsync:z,isPending:M}=V(s.id),q=a.handleSubmit(async o=>{var P;const i=(P=s.fulfillment_providers)==null?void 0:P.map(l=>l.id),g=o.fulfillment_providers??[];await z({add:g.filter(l=>!(i!=null&&i.includes(l))),remove:i==null?void 0:i.filter(l=>!g.includes(l))},{onSuccess:()=>{S.success(e("stockLocations.fulfillmentProviders.successToast")),r(`/settings/locations/${s.id}`)},onError:l=>{S.error(l.message)}})});if(R)throw E;return t.jsx(d.Form,{form:a,children:t.jsxs("div",{className:"flex h-full flex-col overflow-hidden",children:[t.jsx(d.Body,{children:t.jsx(X,{table:L,columns:h,pageSize:f,isLoading:w,count:p,filters:D,search:"autofocus",pagination:!0,orderBy:[{key:"id",label:e("fields.id")}],queryObject:F,layout:"fill"})}),t.jsx(d.Footer,{children:t.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[t.jsx(d.Close,{asChild:!0,children:t.jsx(j,{size:"small",variant:"secondary",children:e("actions.cancel")})}),t.jsx(j,{size:"small",isLoading:M,onClick:q,children:e("actions.save")})]})})]})})},ie=k(),le=()=>{const s=se();return m.useMemo(()=>[ie.display({id:"select",header:({table:e})=>t.jsx(y,{checked:e.getIsSomePageRowsSelected()?"indeterminate":e.getIsAllPageRowsSelected(),onCheckedChange:r=>e.toggleAllPageRowsSelected(!!r)}),cell:({row:e})=>t.jsx(y,{checked:e.getIsSelected(),onCheckedChange:r=>e.toggleSelected(!!r),onClick:r=>{r.stopPropagation()}})}),...s],[s])},ze=()=>{const{location_id:s}=N(),{stock_location:e,isPending:r,isFetching:a,isError:n,error:u}=O(s,{fields:"id,*fulfillment_providers"}),c=!r&&!a&&!!e;if(n)throw u;return t.jsx(d,{children:c&&t.jsx(ae,{location:e})})};export{ze as Component};
