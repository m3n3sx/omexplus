import{V as I}from"./chunk-EUTK2A3J-CZpwcbuN.js";import{u as F}from"./chunk-6CNRNROJ-E_3DS73Y.js";import{C}from"./chunk-BNH57GBH-CVcfdPko.js";import{K as V}from"./chunk-CEEYZHMN-CS2BVby7.js";import{R as m,u as w}from"./chunk-MDIOSTKB-DN-HuFMP.js";import{R as E,aw as M,j as e,b as P,aa as S,x as z,az as T,t as f,B as h,H as L,w as a,y as _,I as R,z as k,ad as A,s as B,a4 as g,af as $,ah as H,a6 as K,aq as x}from"./index-DX2a82HP.js";import{X as D}from"./x-mark-mini-p1eXR82b.js";import"./triangles-mini-t1P0b0yc.js";import"./plus-mini-Dl4b05ye.js";import"./prompt-BcBTqHKt.js";var X=g({inventory:$(g({inventory_item_id:K().min(1,x.t("products.variant.inventory.validation.itemId")),required_quantity:H({errorMap:()=>({message:x.t("products.variant.inventory.validation.quantity")})}).min(0,x.t("products.variant.inventory.validation.quantity"))}))});function O({variant:r}){const{t:i}=P(),{handleSuccess:u}=w(),l=S({defaultValues:{inventory:r.inventory_items.length?r.inventory_items.map(s=>({required_quantity:s.required_quantity,inventory_item_id:s.inventory.id})):[{inventory_item_id:"",required_quantity:""}]},resolver:A(X)}),c=z({control:l.control,name:"inventory"}),y=c.fields.length>1,p=F({queryKey:["inventory_items"],queryFn:s=>B.admin.inventoryItem.list(s),getOptions:s=>s.inventory_items.map(n=>({label:n.title,value:n.id}))}),{mutateAsync:j,isPending:q}=T(r.product_id),b=l.handleSubmit(async s=>{const n={},d={};r.inventory_items.forEach(t=>n[t.inventory.id]=t.required_quantity),s.inventory.forEach(t=>d[t.inventory_item_id]=!0);const o={create:[],update:[],delete:[]};s.inventory.forEach(t=>{t.inventory_item_id in n?t.required_quantity!==n[t.inventory_item_id]&&o.update.push({required_quantity:t.required_quantity,inventory_item_id:t.inventory_item_id,variant_id:r.id}):o.create.push({required_quantity:t.required_quantity,inventory_item_id:t.inventory_item_id,variant_id:r.id})}),r.inventory_items.forEach(t=>{t.inventory.id in d||o.delete.push({inventory_item_id:t.inventory.id,variant_id:r.id})});for(const t in o)o[t].length||delete o[t];await j(o,{onSuccess:()=>{f.success(i("products.variant.inventory.toast.itemsManageSuccess")),u()},onError:t=>{f.error(t.message)}})});return e.jsx(m.Form,{form:l,children:e.jsxs(V,{className:"flex h-full flex-col overflow-hidden",onSubmit:b,children:[e.jsx(m.Header,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(m.Close,{asChild:!0,children:e.jsx(h,{size:"small",variant:"secondary",children:i("actions.cancel")})}),e.jsx(h,{size:"small",type:"submit",isLoading:q,children:i("actions.save")})]})}),e.jsx(m.Body,{className:"flex justify-center",children:e.jsxs("div",{className:"flex w-full flex-col gap-y-8 px-6 pt-12 md:w-[720px] md:pt-24",children:[e.jsx(L,{children:i(y?"products.create.inventory.heading":"fields.inventoryItems")}),e.jsxs("div",{className:"grid gap-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(a.Label,{children:r.title}),e.jsx(a.Hint,{children:i(y?"products.create.inventory.label":"fields.inventoryItem")})]}),e.jsx(h,{size:"small",variant:"secondary",type:"button",onClick:()=>{c.append({inventory_item_id:"",required_quantity:""})},children:i("actions.add")})]}),c.fields.map((s,n)=>e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest grid grid-cols-[1fr_28px] items-center gap-1.5 rounded-xl p-1.5",children:[e.jsxs("div",{className:"grid grid-cols-[min-content,1fr] items-center gap-1.5",children:[e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(_,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`inventory.${n}.inventory_item_id`,children:i("fields.item")})}),e.jsx(a.Field,{control:l.control,name:`inventory.${n}.inventory_item_id`,render:({field:d})=>e.jsxs(a.Item,{children:[e.jsx(a.Control,{children:e.jsx(C,{...d,options:p.options,searchValue:p.searchValue,onSearchValueChange:p.onSearchValueChange,fetchNextPage:p.fetchNextPage,className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",placeholder:i("products.create.inventory.itemPlaceholder")})}),e.jsx(a.ErrorMessage,{})]})}),e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(_,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`inventory.${n}.required_quantity`,children:i("fields.quantity")})}),e.jsx(a.Field,{control:l.control,name:`inventory.${n}.required_quantity`,render:({field:{onChange:d,value:o,...t}})=>e.jsxs(a.Item,{children:[e.jsx(a.Control,{children:e.jsx(R,{type:"number",className:"bg-ui-bg-field-component",min:0,value:o,onChange:N=>{const v=N.target.value;d(v===""?null:Number(v))},...t,placeholder:i("products.create.inventory.quantityPlaceholder")})}),e.jsx(a.ErrorMessage,{})]})})]}),e.jsx(k,{type:"button",size:"small",variant:"transparent",className:"text-ui-fg-muted",onClick:()=>c.remove(n),children:e.jsx(D,{})})]},s.id))]})]})})]})})}function ne(){const{id:r,variant_id:i}=E(),{variant:u,isPending:l,isError:c,error:y}=M(r,i,{fields:I});if(c)throw y;return e.jsx(m,{children:!l&&u&&e.jsx(O,{variant:u})})}export{ne as Component};
