import{g as S}from"./chunk-FSMQADBD-DQ6u7KYm.js";import{V as b}from"./chunk-EUTK2A3J-CZpwcbuN.js";import{L as C}from"./chunk-6WKBBTKM-Dc4I7oW4.js";import{S as v}from"./chunk-ULQT3HE4-D9PRUunE.js";import{J as y}from"./chunk-3IW4HYUP-GSXGtQm6.js";import{P as x}from"./chunk-P3UUX2T6-DeTt74xj.js";import{u as P,D}from"./chunk-XVFA73MY-AMj50WTj.js";import{d as I,R as T,aw as V,j as e,O as k,s as z,ax as A,q as g,b as d,u as L,a0 as E,H as p,A as f,Z as K,a1 as w,r as _,ay as M,B as R}from"./index-DX2a82HP.js";import"./lodash-CVxbbwuF.js";import{N as B}from"./chunk-WX2SMNCD-C6PHMHma.js";import"./chunk-5AU4DI7M-HrTrxcOJ.js";import"./chunk-E3YGDIJC-JnAcRQyg.js";import{C as q}from"./component-s0J86lEx.js";import{P as Q}from"./pencil-square-KR79zc4C.js";import{T as H}from"./trash-C2tUw52M.js";import{u as $}from"./use-prompt-DnhQyBkV.js";import{C as h}from"./container-DmZUKVqp.js";import{c as O}from"./index-BUcLkKzP.js";import"./chunk-MWVM4TYO-bKUcYSnf.js";import"./Trans-COftCGG7.js";import"./x-mark-mini-p1eXR82b.js";import"./chunk-YEDAFXMB-pzp1i2bd.js";import"./chunk-AOFGTNG6-CQXl4ceK.js";import"./command-bar-DI3uUyU0.js";import"./index-CzIYclp8.js";import"./plus-mini-Dl4b05ye.js";import"./chunk-QAF7PVQE-q7JGHsta.js";import"./format-CG1SSrem.js";import"./date-picker--Tjqtae5.js";import"./popover-BPEhH8ld.js";import"./triangle-left-mini-LkqMp4G9.js";import"./prompt-BcBTqHKt.js";var F=(t,s)=>({queryKey:A.detail(s),queryFn:async()=>z.admin.product.retrieveVariant(t,s,{fields:b})}),Te=async({params:t})=>{const s=t.id,a=t.variant_id,i=F(s,a);return g.getQueryData(i.queryKey)??await g.fetchQuery(i)};function G({variant:t}){var c;const{t:s}=d(),a=$(),i=L(),n=((c=t.inventory)==null?void 0:c.length)>1,{mutateAsync:l}=E(t.product_id,t.id),o=async()=>{await a({title:s("general.areYouSure"),description:s("products.variant.deleteWarning",{title:t.title}),confirmText:s("actions.delete"),cancelText:s("actions.cancel")})&&await l(void 0,{onSuccess:()=>{i("..",{replace:!0})}})};return e.jsxs(h,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{children:t.title}),n&&e.jsx("span",{className:"text-ui-fg-muted font-normal",children:e.jsx(q,{})})]}),e.jsx("span",{className:"text-ui-fg-subtle txt-small mt-2",children:s("labels.productVariant")})]}),e.jsx("div",{className:"flex items-center gap-x-4",children:e.jsx(f,{groups:[{actions:[{label:s("actions.edit"),to:"edit",icon:e.jsx(Q,{})}]},{actions:[{label:s("actions.delete"),onClick:o,icon:e.jsx(H,{})}]}]})})]}),e.jsx(v,{title:s("fields.sku"),value:t.sku}),t.options.map(r=>{var m;return e.jsx(v,{title:(m=r.option)==null?void 0:m.title,value:e.jsx(K,{size:"2xsmall",children:r.value})},r.id)})]})}var J=({item:t})=>{const{t:s}=d();return e.jsx(f,{groups:[{actions:[{icon:e.jsx(w,{}),label:s("products.variant.inventory.navigateToItem"),to:`/inventory/${t.id}`}]}]})},u=O(),Z=()=>{const{t}=d();return _.useMemo(()=>[u.accessor("title",{header:t("fields.title"),cell:({getValue:s})=>{const a=s();return a?e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:a})}):e.jsx(x,{})}}),u.accessor("sku",{header:t("fields.sku"),cell:({getValue:s})=>{const a=s();return a?e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:a})}):e.jsx(x,{})}}),u.accessor("required_quantity",{header:t("fields.requiredQuantity"),cell:({getValue:s})=>{const a=s();return Number.isNaN(a)?e.jsx(x,{}):e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:a})})}}),u.display({id:"inventory_quantity",header:t("fields.inventory"),cell:({getValue:s,row:{original:a}})=>{var l;if(!((l=a.location_levels)!=null&&l.length))return e.jsx(x,{});let i=0,n=0;return a.location_levels.forEach(o=>{i+=o.available_quantity,n+=1}),e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:t("products.variant.tableItem",{availableCount:i,locationCount:n,count:n})})})}}),u.display({id:"actions",cell:({row:s})=>e.jsx(J,{item:s.original})})],[t])},N=20;function U({inventoryItems:t}){const{t:s}=d(),a=Z(),{table:i}=P({data:t??[],columns:a,count:t.length,enablePagination:!0,getRowId:l=>l.id,pageSize:N}),n=t.length>1;return e.jsxs(h,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(p,{level:"h2",children:s("fields.inventoryItems")})}),e.jsx("div",{className:"flex items-center gap-x-4",children:e.jsx(f,{groups:[{actions:[{label:s(n?"products.variant.inventory.manageKit":"products.variant.inventory.manageItems"),to:"manage-items",icon:n?e.jsx(q,{}):e.jsx(w,{})}]}]})})]}),e.jsx(D,{table:i,columns:a,pageSize:N,count:t.length,navigateTo:l=>`/inventory/${l.id}`})]})}function W(){const{t}=d();return e.jsx(h,{className:"divide-y p-0",children:e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(p,{level:"h2",children:t("fields.inventoryItems")}),e.jsx("span",{className:"txt-small text-ui-fg-subtle",children:t("products.variant.inventory.notManagedDesc")})]}),e.jsx("div",{className:"flex items-center gap-x-4",children:e.jsx(C,{to:"edit",children:t("products.variant.edit.header")})})]})})}function Y({variant:t}){const{t:s}=d(),a=t.prices.filter(r=>!Object.keys(r.rules||{}).length).sort((r,m)=>{var j;return(j=r.currency_code)==null?void 0:j.localeCompare(m.currency_code)}),i=!!a.length,[n,l]=_.useState(3),o=a.slice(0,n),c=()=>{l(n+3)};return e.jsxs(h,{className:"flex flex-col divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(p,{level:"h2",children:s("labels.prices")}),e.jsx(f,{groups:[{actions:[{label:s("actions.edit"),to:`/products/${t.product_id}/variants/${t.id}/prices`,icon:e.jsx(M,{})}]}]})]}),!i&&e.jsx(B,{className:"h-60"}),o.map(r=>e.jsxs("div",{className:"txt-small text-ui-fg-subtle flex justify-between px-6 py-4",children:[e.jsx("span",{className:"font-medium",children:r.currency_code.toUpperCase()}),e.jsx("span",{children:S(r.amount,r.currency_code)})]},r.id)),i&&e.jsxs("div",{className:"txt-small text-ui-fg-subtle flex items-center justify-between px-6 py-4",children:[e.jsx("span",{className:"font-medium",children:s("products.variant.pricesPagination",{total:a.length,current:Math.min(n,a.length)})}),e.jsx(R,{onClick:c,disabled:n>=a.length,className:"-mr-3 text-blue-500",variant:"transparent",children:s("actions.showMore")})]})]})}var Ve=()=>{const t=I(),{id:s,variant_id:a}=T(),{variant:i,isLoading:n,isError:l,error:o}=V(s,a,{fields:b},{initialData:t});if(n||!i)return e.jsx("div",{children:"Loading..."});if(l)throw o;return e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsxs("div",{className:"flex flex-col gap-x-4 gap-y-3 xl:flex-row xl:items-start",children:[e.jsxs("div",{className:"flex w-full flex-col gap-y-3",children:[e.jsx(G,{variant:i}),i.manage_inventory?e.jsx(U,{inventoryItems:i.inventory_items.map(c=>({...c.inventory,required_quantity:c.required_quantity,variant:i}))}):e.jsx(W,{}),e.jsx("div",{className:"hidden xl:block",children:e.jsx(y,{data:i,root:"product"})})]}),e.jsxs("div",{className:"flex w-full max-w-[100%] flex-col gap-y-3 xl:mt-0 xl:max-w-[400px]",children:[e.jsx(Y,{variant:i}),e.jsx("div",{className:"xl:hidden",children:e.jsx(y,{data:i})})]})]}),e.jsx(k,{})]})};export{Ve as Component,Te as loader};
