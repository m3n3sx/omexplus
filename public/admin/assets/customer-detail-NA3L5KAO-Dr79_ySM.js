import{u as E,a as I,b as Q}from"./chunk-QIWEFQ5Y-Cps0jphI.js";import{R as _,d as B,dQ as L,a as M,j as e,dB as K,s as b,p as O,q as f,b as w,u as H,dR as F,H as T,A as k,T as u,r as P,dI as $,k as J,bl as o,L as Y,B as W,t as p,dS as Z,dT as U}from"./index-DX2a82HP.js";import{S as V}from"./chunk-UR2E444G-CIn7FNeD.js";import"./chunk-3IW4HYUP-GSXGtQm6.js";import{u as X,D as ee}from"./chunk-XVFA73MY-AMj50WTj.js";import"./lodash-CVxbbwuF.js";import"./chunk-5AU4DI7M-HrTrxcOJ.js";import"./chunk-E3YGDIJC-JnAcRQyg.js";import{P as R}from"./pencil-square-KR79zc4C.js";import{T as D}from"./trash-C2tUw52M.js";import{u as y}from"./use-prompt-DnhQyBkV.js";import{C as G}from"./container-DmZUKVqp.js";import{S as se}from"./status-badge-CfWr32Ew.js";import{c as te}from"./index-BUcLkKzP.js";import{C}from"./checkbox-BO157Suw.js";import"./chunk-C76H5USB-jBtboAOl.js";import"./chunk-OI7BBNYW-DJOf1CE_.js";import"./chunk-P3UUX2T6-DeTt74xj.js";import"./Trans-COftCGG7.js";import"./x-mark-mini-p1eXR82b.js";import"./chunk-YEDAFXMB-pzp1i2bd.js";import"./chunk-AOFGTNG6-CQXl4ceK.js";import"./chunk-WX2SMNCD-C6PHMHma.js";import"./plus-mini-Dl4b05ye.js";import"./command-bar-DI3uUyU0.js";import"./index-CzIYclp8.js";import"./chunk-QAF7PVQE-q7JGHsta.js";import"./format-CG1SSrem.js";import"./date-picker--Tjqtae5.js";import"./popover-BPEhH8ld.js";import"./triangle-left-mini-LkqMp4G9.js";import"./prompt-BcBTqHKt.js";var ae=({customer:s})=>{const{t}=w(),a=y(),r=H(),{mutateAsync:n}=F(s.id),c=[s.first_name,s.last_name].filter(Boolean).join(" "),i=s.has_account?"green":"orange",m=s.has_account?t("customers.fields.registered"):t("customers.fields.guest"),g=async()=>{await a({title:t("customers.delete.title"),description:t("customers.delete.description",{email:s.email}),verificationInstruction:t("general.typeToConfirm"),verificationText:s.email,confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await n(void 0,{onSuccess:()=>{p.success(t("customers.delete.successToast",{email:s.email})),r("/customers",{replace:!0})},onError:x=>{p.error(x.message)}})};return e.jsxs(G,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(T,{children:s.email}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(se,{color:i,children:m}),e.jsx(k,{groups:[{actions:[{label:t("actions.edit"),icon:e.jsx(R,{}),to:"edit"}]},{actions:[{label:t("actions.delete"),icon:e.jsx(D,{}),onClick:g}]}]})]})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(u,{size:"small",leading:"compact",weight:"plus",children:t("fields.name")}),e.jsx(u,{size:"small",leading:"compact",children:c||"-"})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(u,{size:"small",leading:"compact",weight:"plus",children:t("fields.company")}),e.jsx(u,{size:"small",leading:"compact",children:s.company_name||"-"})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(u,{size:"small",leading:"compact",weight:"plus",children:t("fields.phone")}),e.jsx(u,{size:"small",leading:"compact",children:s.phone||"-"})]})]})},h=10,re=({customer:s})=>{const t=y(),[a,r]=P.useState({}),{raw:n,searchParams:c}=E({pageSize:h}),{customer_groups:i,count:m,isLoading:g,isError:j,error:x}=$({...c,fields:"+customers.id",customers:{id:s.id}},{placeholderData:J}),N=I(),v=ie(s.id),{table:z}=X({data:i??[],columns:v,count:m,getRowId:d=>d.id,enablePagination:!0,enableRowSelection:!0,pageSize:h,rowSelection:{state:a,updater:r}}),A=async()=>{const d=Object.keys(a);if(await t({title:o("general.areYouSure"),description:o("customers.groups.removeMany",{groups:i==null?void 0:i.filter(l=>d.includes(l.id)).map(l=>l.name).join(",")}),confirmText:o("actions.remove"),cancelText:o("actions.cancel")}))try{const l=d.map(q=>b.admin.customerGroup.batchCustomers(q,{remove:[s.id]}));await Promise.all(l),await f.invalidateQueries({queryKey:Z.lists()})}catch(l){p.error(l.message)}};if(j)throw x;return e.jsxs(G,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(T,{level:"h2",children:o("customerGroups.domain")}),e.jsx(Y,{to:`/customers/${s.id}/add-customer-groups`,children:e.jsx(W,{variant:"secondary",size:"small",children:o("general.add")})})]}),e.jsx(ee,{table:z,columns:v,pageSize:h,isLoading:g,count:m,navigateTo:d=>`/customer-groups/${d.id}`,filters:N,search:!0,pagination:!0,orderBy:[{key:"name",label:o("fields.name")},{key:"created_at",label:o("fields.createdAt")},{key:"updated_at",label:o("fields.updatedAt")}],commands:[{action:A,label:o("actions.remove"),shortcut:"r"}],queryObject:n,noRecords:{message:o("customers.groups.list.noRecordsMessage")}})]})},oe=({group:s,customerId:t})=>{const a=y(),{t:r}=w(),{mutateAsync:n}=U(s.id),c=async()=>{await a({title:r("general.areYouSure"),description:r("customers.groups.remove",{name:s.name}),confirmText:r("actions.remove"),cancelText:r("actions.cancel")})&&await n([t],{onError:m=>{p.error(m.message)}})};return e.jsx(k,{groups:[{actions:[{label:r("actions.edit"),icon:e.jsx(R,{}),to:`/customer-groups/${s.id}/edit`},{label:r("actions.remove"),onClick:c,icon:e.jsx(D,{})}]}]})},S=te(),ie=s=>{const t=Q();return P.useMemo(()=>[S.display({id:"select",header:({table:a})=>e.jsx(C,{checked:a.getIsSomePageRowsSelected()?"indeterminate":a.getIsAllPageRowsSelected(),onCheckedChange:r=>a.toggleAllPageRowsSelected(!!r)}),cell:({row:a})=>e.jsx(C,{checked:a.getIsSelected(),onCheckedChange:r=>a.toggleSelected(!!r),onClick:r=>{r.stopPropagation()}})}),...t,S.display({id:"actions",cell:({row:a})=>e.jsx(oe,{group:a.original,customerId:s})})],[t])},Me=()=>{const{id:s}=_(),t=B(),{customer:a,isLoading:r,isError:n,error:c}=L(s,void 0,{initialData:t}),{getWidgets:i}=M();if(r||!a)return e.jsx(K,{sections:2,showJSON:!0,showMetadata:!0});if(n)throw c;return e.jsxs(V,{widgets:{before:i("customer.details.before"),after:i("customer.details.after")},data:a,hasOutlet:!0,showJSON:!0,showMetadata:!0,children:[e.jsx(ae,{customer:a}),e.jsx(re,{customer:a})]})},ne=s=>({queryKey:O.detail(s),queryFn:async()=>b.admin.customer.retrieve(s)}),Ke=async({params:s})=>{const t=s.id,a=ne(t);return f.getQueryData(a.queryKey)??await f.fetchQuery(a)};export{Me as Component,Ke as loader};
