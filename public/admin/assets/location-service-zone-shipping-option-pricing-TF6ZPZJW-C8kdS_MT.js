import{u as k}from"./chunk-4L5I5U7R-BYuuLbqa.js";import{D as A}from"./chunk-BTWRDYKW-DTEt7y2u.js";import{R as G,a9 as H,j as r,b as U,aa as V,g as Z,r as E,i as q,l as J,t as _,B as S,ad as Q,a4 as W,as as v,a6 as f,ah as P}from"./index-DX2a82HP.js";import{d as X,c as Y}from"./chunk-VDODP7YI-D8aV5IgA.js";import{c as R}from"./chunk-6GU6IDUA-CDc7wW5L.js";import{K as rr}from"./chunk-CEEYZHMN-CS2BVby7.js";import{R as u,u as b}from"./chunk-MDIOSTKB-DN-HuFMP.js";import"./chunk-MWVM4TYO-bKUcYSnf.js";import"./index.esm-crGpFqYO.js";import"./index-BUcLkKzP.js";import"./checkbox-BO157Suw.js";import"./prompt-BcBTqHKt.js";var er=e=>{const o={};return e.forEach(s=>{s.price_rules.length||(o[s.currency_code]=s.amount)}),o},sr=e=>{const o={};return e.forEach(s=>{if(s.price_rules.length){const n=s.price_rules[0].value;o[n]=s.amount}}),o},ir=W({region_prices:v(f(),f().or(P()).optional()),currency_prices:v(f(),f().or(P()).optional())});function or({shippingOption:e}){const{t:o}=U(),{handleSuccess:s}=b(),n=V({defaultValues:{region_prices:sr(e.prices),currency_prices:er(e.prices)},resolver:Q(ir)}),{mutateAsync:g,isPending:w}=Y(e.id),{store:d,isLoading:C,isError:L,error:O}=Z(),p=E.useMemo(()=>{var t;return((t=d==null?void 0:d.supported_currencies)==null?void 0:t.map(h=>h.currency_code))||[]},[d]),{regions:c,isLoading:F,isError:N,error:T}=q({fields:"id,name,currency_code",limit:999}),{price_preferences:I}=J({}),{setCloseOnEscape:M}=b(),z=k({name:e.name,currencies:p,regions:c,pricePreferences:I}),B=E.useMemo(()=>[[...p||[],...c||[]]],[p,c]),j=n.handleSubmit(async t=>{const h=Object.entries(t.currency_prices).map(([i,a])=>{if(a===""||a===void 0||!p.some(m=>m.toLowerCase()==i.toLowerCase()))return;const x=R(a),y={currency_code:i,amount:x},l=e.prices.find(m=>m.currency_code===i&&!m.price_rules.length);return l&&(y.id=l.id),y}).filter(i=>!!i),K=Object.entries(t.region_prices).map(([i,a])=>{if(a===""||a===void 0||!(c==null?void 0:c.some(l=>l.id===i)))return;const x=R(a);return{region_id:i,amount:x}}).filter(i=>!!i);await g({prices:[...h,...K]},{onSuccess:()=>{_.success(o("general.success")),s()},onError:i=>{_.error(i.message)}})}),D=C||F||!p||!c;if(L)throw O;if(N)throw T;return r.jsx(u.Form,{form:n,children:r.jsxs(rr,{className:"flex h-full flex-col overflow-hidden",onSubmit:j,children:[r.jsx(u.Header,{}),r.jsx(u.Body,{children:r.jsx("div",{className:"flex size-full flex-col divide-y overflow-hidden",children:r.jsx(A,{isLoading:D,data:B,columns:z,state:n,onEditingChange:t=>M(!t)})})}),r.jsx(u.Footer,{children:r.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[r.jsx(u.Close,{asChild:!0,children:r.jsx(S,{variant:"secondary",size:"small",children:o("actions.cancel")})}),r.jsx(S,{size:"small",className:"whitespace-nowrap",isLoading:w,onClick:j,type:"button",children:o("actions.save")})]})})]})})}function xr(){const{so_id:e,location_id:o}=G();if(!e)throw H({message:"Shipping Option ID paramater is missing",status:404});const{shipping_option:s,isError:n,error:g}=X(e,{fields:"*prices,*prices.price_rules"});if(n)throw g;return r.jsx(u,{prev:`/settings/locations/${o}`,children:s&&r.jsx(or,{shippingOption:s})})}export{xr as Component};
