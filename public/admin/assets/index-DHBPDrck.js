import{r as t,j as v}from"./index-DX2a82HP.js";import{M as L,u as z,P as $,a as A,b as S,L as T}from"./proxy-DzNuHhPq.js";class D extends t.Component{getSnapshotBeforeUpdate(c){const e=this.props.childRef.current;if(e&&c.isPresent&&!this.props.isPresent){const n=this.props.sizeRef.current;n.height=e.offsetHeight||0,n.width=e.offsetWidth||0,n.top=e.offsetTop,n.left=e.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function K({children:r,isPresent:c}){const e=t.useId(),n=t.useRef(null),C=t.useRef({width:0,height:0,top:0,left:0}),{nonce:f}=t.useContext(L);return t.useInsertionEffect(()=>{const{width:d,height:o,top:p,left:s}=C.current;if(c||!n.current||!d||!o)return;n.current.dataset.motionPopId=e;const l=document.createElement("style");return f&&(l.nonce=f),document.head.appendChild(l),l.sheet&&l.sheet.insertRule(`
          [data-motion-pop-id="${e}"] {
            position: absolute !important;
            width: ${d}px !important;
            height: ${o}px !important;
            top: ${p}px !important;
            left: ${s}px !important;
          }
        `),()=>{document.head.removeChild(l)}},[c]),v.jsx(D,{isPresent:c,childRef:n,sizeRef:C,children:t.cloneElement(r,{ref:n})})}const U=({children:r,initial:c,isPresent:e,onExitComplete:n,custom:C,presenceAffectsLayout:f,mode:d})=>{const o=z(B),p=t.useId(),s=t.useCallback(a=>{o.set(a,!0);for(const x of o.values())if(!x)return;n&&n()},[o,n]),l=t.useMemo(()=>({id:p,initial:c,isPresent:e,custom:C,onExitComplete:s,register:a=>(o.set(a,!1),()=>o.delete(a))}),f?[Math.random(),s]:[e,s]);return t.useMemo(()=>{o.forEach((a,x)=>o.set(x,!1))},[e]),t.useEffect(()=>{!e&&!o.size&&n&&n()},[e]),d==="popLayout"&&(r=v.jsx(K,{isPresent:e,children:r})),v.jsx($.Provider,{value:l,children:r})};function B(){return new Map}const y=r=>r.key||"";function j(r){const c=[];return t.Children.forEach(r,e=>{t.isValidElement(e)&&c.push(e)}),c}const H=({children:r,custom:c,initial:e=!0,onExitComplete:n,presenceAffectsLayout:C=!0,mode:f="sync",propagate:d=!1})=>{const[o,p]=A(d),s=t.useMemo(()=>j(r),[r]),l=d&&!o?[]:s.map(y),a=t.useRef(!0),x=t.useRef(s),g=z(()=>new Map),[b,k]=t.useState(s),[h,P]=t.useState(s);S(()=>{a.current=!1,x.current=s;for(let u=0;u<h.length;u++){const i=y(h[u]);l.includes(i)?g.delete(i):g.get(i)!==!0&&g.set(i,!1)}},[h,l.length,l.join("-")]);const R=[];if(s!==b){let u=[...s];for(let i=0;i<h.length;i++){const m=h[i],E=y(m);l.includes(E)||(u.splice(i,0,m),R.push(m))}f==="wait"&&R.length&&(u=R),P(j(u)),k(s);return}f==="wait"&&h.length>1&&console.warn(`You're attempting to animate multiple children within AnimatePresence, but its mode is set to "wait". This will lead to odd visual behaviour.`);const{forceRender:w}=t.useContext(T);return v.jsx(v.Fragment,{children:h.map(u=>{const i=y(u),m=d&&!o?!1:s===h||l.includes(i),E=()=>{if(g.has(i))g.set(i,!0);else return;let M=!0;g.forEach(I=>{I||(M=!1)}),M&&(w==null||w(),P(x.current),d&&(p==null||p()),n&&n())};return v.jsx(U,{isPresent:m,initial:!a.current||e?void 0:!1,custom:m?void 0:c,presenceAffectsLayout:C,mode:f,onExitComplete:m?void 0:E,children:u},i)})})};export{H as A};
