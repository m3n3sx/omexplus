'use client'

import Link from 'next/link'
import { useState, useEffect } from 'react'
import { useLocale } from 'next-intl'
import { usePathname, useRouter } from 'next/navigation'
import { OmexLogo } from './OmexLogo'
import { HeaderIcons } from './HeaderIcons'
import { useCurrency } from '@/contexts/CurrencyContext'

export function FigmaHeader() {
  const locale = useLocale()
  const pathname = usePathname()
  const router = useRouter()
  const { currency, setCurrency } = useCurrency()
  
  const [activeCategory, setActiveCategory] = useState<string | null>(null)
  const [showLanguageMenu, setShowLanguageMenu] = useState(false)
  const [showCurrencyMenu, setShowCurrencyMenu] = useState(false)

  // Close menus when clicking outside
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      const target = event.target as HTMLElement
      if (!target.closest('.language-menu') && !target.closest('.currency-menu')) {
        setShowLanguageMenu(false)
        setShowCurrencyMenu(false)
      }
    }

    document.addEventListener('mousedown', handleClickOutside)
    return () => document.removeEventListener('mousedown', handleClickOutside)
  }, [])

  const languages = [
    { code: 'pl', name: 'Polski', flag: 'ðŸ‡µðŸ‡±' },
    { code: 'en', name: 'English', flag: 'ðŸ‡¬ðŸ‡§' },
    { code: 'de', name: 'Deutsch', flag: 'ðŸ‡©ðŸ‡ª' },
    { code: 'uk', name: 'Ð£ÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÐ°', flag: 'ðŸ‡ºðŸ‡¦' },
  ]

  const currencies = [
    { code: 'PLN', symbol: 'zÅ‚', name: 'Polski ZÅ‚oty' },
    { code: 'EUR', symbol: 'â‚¬', name: 'Euro' },
    { code: 'USD', symbol: '$', name: 'US Dollar' },
    { code: 'GBP', symbol: 'Â£', name: 'British Pound' },
    { code: 'UAH', symbol: 'â‚´', name: 'Ð£ÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÐ° Ð³Ñ€Ð¸Ð²Ð½Ñ' },
  ]

  const currentLanguage = languages.find(lang => lang.code === locale) || languages[0]
  const currentCurrency = currencies.find(curr => curr.code === currency) || currencies[0]

  const handleLanguageChange = (newLocale: string) => {
    const currentPath = pathname.replace(`/${locale}`, '')
    router.push(`/${newLocale}${currentPath || '/'}`)
    setShowLanguageMenu(false)
  }

  const handleCurrencyChange = (newCurrency: string) => {
    setCurrency(newCurrency)
    setShowCurrencyMenu(false)
  }

  const categories = [
    {
      id: 'hydraulika-osprzet',
      name: 'Hydraulika',
      subcategories: [
        { name: 'Pompy hydrauliczne', href: '/pl/categories/pompy-hydrauliczne' },
        { name: 'Cylindry hydrauliczne', href: '/pl/categories/cylindry-hydrauliczne' },
        { name: 'Zawory hydrauliczne', href: '/pl/categories/zawory-hydrauliczne' },
        { name: 'WÄ™Å¼e i zÅ‚Ä…czki', href: '/pl/categories/waz-hydrauliczny-zlaczki' },
        { name: 'Silniki hydrauliczne', href: '/pl/categories/silniki-hydrauliczne' },
      ]
    },
    {
      id: 'filtry-uszczelnienia',
      name: 'Filtry & Uszczelnienia',
      subcategories: [
        { name: 'Filtry oleju', href: '/pl/categories/filtry-oleju-serwis' },
        { name: 'Filtry hydrauliczne', href: '/pl/categories/filtry-hydrauliczne' },
        { name: 'Filtry powietrza', href: '/pl/categories/filtry-powietrza' },
        { name: 'Uszczelnienia', href: '/pl/categories/uszczelnienia' },
        { name: 'PÅ‚yny hydrauliczne', href: '/pl/categories/plyny-hydrauliczne' },
      ]
    },
    {
      id: 'silnik-osprzet',
      name: 'Silnik & OsprzÄ™t',
      subcategories: [
        { name: 'Silniki spalinowe', href: '/pl/categories/silniki-spalinowe' },
        { name: 'TurbosprÄ™Å¼arki', href: '/pl/categories/turbosprezarki' },
        { name: 'UkÅ‚ad chÅ‚odzenia', href: '/pl/categories/uklad-chlodzenia' },
        { name: 'UkÅ‚ad paliwowy', href: '/pl/categories/uklad-paliwowy' },
        { name: 'Skrzynia biegÃ³w', href: '/pl/categories/skrzynia-biegow-przeniesienie' },
      ]
    },
    {
      id: 'podwozia-gasienice',
      name: 'Podwozie & GÄ…sienice',
      subcategories: [
        { name: 'GÄ…sienice gumowe', href: '/pl/categories/gasienice-gumowe' },
        { name: 'CzÄ™Å›ci podwozia', href: '/pl/categories/czesci-podwozia' },
        { name: 'Podwozia koÅ‚owe', href: '/pl/categories/podwozia-kolowe' },
        { name: 'Element obrotu', href: '/pl/categories/element-obrotu-ramiona' },
      ]
    },
    {
      id: 'elektryka-elektronika',
      name: 'Elektryka',
      subcategories: [
        { name: 'Elektryka & Elektronika', href: '/pl/categories/elektryka-elektronika' },
      ]
    },
    {
      id: 'nadwozie-oprawa',
      name: 'Kabina & Nadwozie',
      subcategories: [
        { name: 'Nadwozie & Oprawa', href: '/pl/categories/nadwozie-oprawa' },
      ]
    },
    {
      id: 'osprzet-wymienne-czesci',
      name: 'OsprzÄ™t & NarzÄ™dzia',
      subcategories: [
        { name: 'OsprzÄ™t wymienne czÄ™Å›ci', href: '/pl/categories/osprzet-wymienne-czesci' },
        { name: 'Normalia warsztatowe', href: '/pl/categories/normalia-warsztatowe' },
      ]
    },
  ]

  return (
    <header className="sticky top-0 z-50 bg-white shadow-sm">
      {/* Olive accent line */}
      <div className="h-0.5 bg-primary-500"></div>
      
      {/* Top Navbar - Minimal beige theme */}
      <div className="bg-neutral-50 border-b border-neutral-200">
        <div className="container mx-auto px-6 lg:px-12 max-w-[1400px]">
          <div className="flex items-center justify-between h-10">
            {/* Left: Language & Currency */}
            <div className="flex items-center gap-8 text-[11px] font-bold text-secondary-600">
              {/* Language Selector */}
              <div className="relative language-menu">
                <button 
                  onClick={() => {
                    setShowLanguageMenu(!showLanguageMenu)
                    setShowCurrencyMenu(false)
                  }}
                  className="hover:text-primary-600 transition-colors flex items-center gap-1.5 uppercase tracking-wider font-bold"
                >
                  <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth={2}>
                    <path strokeLinecap="round" strokeLinejoin="round" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
                  </svg>
                  <span>{currentLanguage.flag} {currentLanguage.name}</span>
                  <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                  </svg>
                </button>
                
                {showLanguageMenu && (
                  <div className="absolute top-full left-0 mt-2 bg-white rounded-2xl shadow-xl border border-neutral-200 py-2 min-w-[180px] z-50">
                    {languages.map((lang) => (
                      <button
                        key={lang.code}
                        onClick={() => handleLanguageChange(lang.code)}
                        className={`w-full px-4 py-2 text-left text-[13px] font-bold flex items-center gap-2 transition-colors ${
                          locale === lang.code
                            ? 'bg-neutral-50 text-primary-600 border-l-2 border-primary-500'
                            : 'text-secondary-600 hover:bg-neutral-50 hover:text-primary-600'
                        }`}
                      >
                        <span className="text-lg">{lang.flag}</span>
                        <span>{lang.name}</span>
                        {locale === lang.code && (
                          <svg className="w-4 h-4 ml-auto" fill="currentColor" viewBox="0 0 20 20">
                            <path fillRule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clipRule="evenodd" />
                          </svg>
                        )}
                      </button>
                    ))}
                  </div>
                )}
              </div>

              {/* Currency Selector */}
              <div className="relative currency-menu">
                <button 
                  onClick={() => {
                    setShowCurrencyMenu(!showCurrencyMenu)
                    setShowLanguageMenu(false)
                  }}
                  className="hover:text-primary-600 transition-colors flex items-center gap-1.5 uppercase tracking-wider font-bold"
                >
                  <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth={2}>
                    <path strokeLinecap="round" strokeLinejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  <span>{currentCurrency.code}</span>
                  <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                  </svg>
                </button>
                
                {showCurrencyMenu && (
                  <div className="absolute top-full left-0 mt-2 bg-white rounded-2xl shadow-xl border border-neutral-200 py-2 min-w-[180px] z-50">
                    {currencies.map((curr) => (
                      <button
                        key={curr.code}
                        onClick={() => handleCurrencyChange(curr.code)}
                        className={`w-full px-4 py-2 text-left text-[13px] font-bold flex items-center gap-2 transition-colors ${
                          currency === curr.code
                            ? 'bg-neutral-50 text-primary-600 border-l-2 border-primary-500'
                            : 'text-secondary-600 hover:bg-neutral-50 hover:text-primary-600'
                        }`}
                      >
                        <span className="font-bold">{curr.symbol}</span>
                        <span>{curr.code} - {curr.name}</span>
                        {currency === curr.code && (
                          <svg className="w-4 h-4 ml-auto" fill="currentColor" viewBox="0 0 20 20">
                            <path fillRule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clipRule="evenodd" />
                          </svg>
                        )}
                      </button>
                    ))}
                  </div>
                )}
              </div>
            </div>

            {/* Right: Contact Info */}
            <div className="hidden md:flex items-center gap-10 text-[11px] font-bold text-secondary-600">
              <a href="tel:+48123456789" className="flex items-center gap-2 hover:text-primary-600 transition-colors">
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                </svg>
                +48 123 456 789
              </a>
              <a href="mailto:kontakt@omex.pl" className="flex items-center gap-2 hover:text-primary-600 transition-colors">
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                </svg>
                kontakt@omex.pl
              </a>
            </div>
          </div>
        </div>
      </div>

      {/* Main Navigation - Light theme - Modern spacing */}
      <div className="bg-white border-b border-neutral-200 shadow-sm">
        <div className="container mx-auto px-6 lg:px-12 max-w-[1400px]">
          <div className="flex items-center justify-between h-24">
            {/* Logo - Larger for modern look */}
            <Link href="/pl" className="transition-transform hover:scale-105 duration-300">
              <OmexLogo variant="full" size="lg" />
            </Link>

            {/* Center: Navigation Links - More spacing */}
            <div className="hidden lg:flex items-center gap-4 flex-1 ml-16">
              <Link href="/pl/tracking" className="relative font-bold text-sm text-secondary-700 hover:text-primary-600 transition-colors px-5 py-2.5 flex items-center gap-2 group uppercase tracking-wider">
                <span className="absolute inset-0 bg-neutral-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-full"></span>
                <svg className="w-4 h-4 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth={2}>
                  <path strokeLinecap="round" strokeLinejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path strokeLinecap="round" strokeLinejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                <span className="relative z-10">Åšledzenie</span>
              </Link>
              <span className="text-neutral-300">/</span>
              <Link href="/pl/faq" className="relative font-bold text-sm text-secondary-700 hover:text-primary-600 transition-colors px-5 py-2.5 flex items-center gap-2 group uppercase tracking-wider">
                <span className="absolute inset-0 bg-neutral-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-full"></span>
                <svg className="w-4 h-4 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth={2}>
                  <path strokeLinecap="round" strokeLinejoin="round" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span className="relative z-10">FAQ</span>
              </Link>
              <span className="text-neutral-300">/</span>
              <Link href="/pl/o-nas" className="relative font-bold text-sm text-secondary-700 hover:text-primary-600 transition-colors px-5 py-2.5 flex items-center gap-2 group uppercase tracking-wider">
                <span className="absolute inset-0 bg-neutral-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-full"></span>
                <svg className="w-4 h-4 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth={2}>
                  <path strokeLinecap="round" strokeLinejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span className="relative z-10">O nas</span>
              </Link>
              <span className="text-neutral-300">/</span>
              <Link href="/pl/kontakt" className="relative font-bold text-sm text-secondary-700 hover:text-primary-600 transition-colors px-5 py-2.5 flex items-center gap-2 group uppercase tracking-wider">
                <span className="absolute inset-0 bg-neutral-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-full"></span>
                <svg className="w-4 h-4 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth={2}>
                  <path strokeLinecap="round" strokeLinejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                </svg>
                <span className="relative z-10">Kontakt</span>
              </Link>
              <span className="text-neutral-300">/</span>
              <Link href="/pl/promocje" className="relative font-normal text-sm text-white bg-primary-500 px-6 py-3 transition-all flex items-center gap-2 hover:bg-primary-600 hover:-translate-y-0.5 group rounded-full shadow-md hover:shadow-xl uppercase tracking-wider">
                <svg className="w-4 h-4 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth={2.5}>
                  <path strokeLinecap="round" strokeLinejoin="round" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7" />
                </svg>
                <span className="relative z-10">Promocje</span>
              </Link>
            </div>

            {/* Icons */}
            <HeaderIcons />
          </div>
        </div>
      </div>

      {/* Horizontal Mega Menu - Minimal beige theme */}
      <div className="bg-neutral-50 border-b border-neutral-200 relative">
        <div className="container mx-auto px-6 lg:px-12 max-w-[1400px]">
          <nav className="flex items-center gap-3">
            {categories.map((category, index) => (
              <div key={category.id} className="flex items-center gap-2">
                <div
                  onMouseEnter={() => setActiveCategory(category.id)}
                  onMouseLeave={() => setActiveCategory(null)}
                >
                  <button 
                    className={`relative px-6 py-4 text-sm font-bold transition-all whitespace-nowrap uppercase tracking-wider rounded-full ${
                      activeCategory === category.id 
                        ? 'text-primary-600 bg-white shadow-sm border border-primary-500' 
                        : 'text-secondary-600 hover:text-primary-600 hover:bg-white'
                    }`}
                  >
                    <span className="relative z-10">{category.name}</span>
                  </button>
                </div>
                {index < categories.length - 1 && (
                  <span className="text-neutral-300">|</span>
                )}
              </div>
            ))}
          </nav>
        </div>

        {/* Mega Menu Dropdown - Light theme full width */}
        {activeCategory && categories.find(cat => cat.id === activeCategory)?.subcategories && (
          <div 
            className="absolute left-0 right-0 top-full w-full z-50"
            onMouseEnter={() => setActiveCategory(activeCategory)}
            onMouseLeave={() => setActiveCategory(null)}
          >
            <div className="bg-white border-t-2 border-primary-500 shadow-xl py-8 rounded-b-2xl">
              <div className="container mx-auto px-6 lg:px-12 max-w-[1400px]">
                {categories.filter(cat => cat.id === activeCategory).map(category => (
                  <div key={category.id}>
                    <div className="grid grid-cols-3 gap-4">
                      {category.subcategories.map((sub, idx) => (
                        <Link
                          key={idx}
                          href={sub.href}
                          className="block px-5 py-3 text-[13px] font-bold text-secondary-600 hover:text-primary-600 transition-colors hover:bg-neutral-50 rounded-full border border-transparent hover:border-primary-500"
                        >
                          {sub.name}
                        </Link>
                      ))}
                    </div>
                    <div className="border-t border-neutral-200 mt-4 pt-4">
                      <Link
                        href={`/pl/categories/${category.id}`}
                        className="inline-block px-6 py-2.5 text-[13px] text-white bg-primary-500 hover:bg-primary-600 font-normal transition-all rounded-full shadow-md uppercase tracking-wider"
                      >
                        Zobacz wszystkie w kategorii {category.name} â†’
                      </Link>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        )}
      </div>
    </header>
  )
}
